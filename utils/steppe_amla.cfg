#textdomain wesnoth-gse

#define SPECIAL_NOTE_STEPPE_AMLA
[special_note]
    note=_"This unit has custom AMLA upgrades."
[/special_note]
#enddef

#note to self: abilities with events inside them don't work with [effect] - the events need to be moved into the eventloader for them to work

#define STEPPE_ADVANCEMENT ID DESCR IMAGE PARAMS
    [advancement]
        id={ID}
        description={DESCR}
        image={IMAGE}
        {PARAMS}
        [effect]
            apply_to=hitpoints
            heal_full=yes
        [/effect]
        [effect]
            apply_to=status
            remove=poisoned
        [/effect]
        [effect]
            apply_to=status
            remove=slowed
        [/effect]
    [/advancement]
    {SPECIAL_NOTE_STEPPE_AMLA}
#enddef

#define STEPPE_ADVANCEMENT_FILTERED ID DESCR IMAGE FILTER PARAMS
    [advancement]
        id={ID}
        description={DESCR}
        image={IMAGE}
        [filter]
        {FILTER}
        [/filter]
        {PARAMS}
        [effect]
            apply_to=hitpoints
            heal_full=yes
        [/effect]
        [effect]
            apply_to=status
            remove=poisoned
        [/effect]
        [effect]
            apply_to=status
            remove=slowed
        [/effect]
    [/advancement]
    {SPECIAL_NOTE_STEPPE_AMLA}
#enddef 

#define STEPPE_ADVANCEMENT_BUILDOPTION AMLA_ID DESCR IMAGE ID DESCRIPTION COST UNIT MOVESCOST EFFECTS
    [advancement]
        id={AMLA_ID}
        description={DESCR}
        image={IMAGE}
        {EFFECTS}
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDOPTION {ID} {DESCRIPTION} {COST} {UNIT} {MOVESCOST}}
            [/abilities]
        [/effect]
        [effect]
            apply_to=hitpoints
            heal_full=yes
        [/effect]
        [effect]
            apply_to=status
            remove=poisoned
        [/effect]
        [effect]
            apply_to=status
            remove=slowed
        [/effect]
    [/advancement]
#the event is placed inside the unit file itself
    {BUILDOPTION_EVENT {ID} {DESCRIPTION} {COST} {UNIT} {MOVESCOST}}
    {SPECIAL_NOTE_STEPPE_AMLA}
#enddef

#define EVENTLOADER_EVENTS_AMLA
[event]
    name=post advance
    id=steppe_slave_citizenship
    first_time_only=no
    [filter]
      ability=steppe_slave
      [not]
         ability=wasslave #don't apply citizenship to recruitable slaves, as they already have something similar on lvl2
      [/not]
    [/filter]

#check if advances_to is a null value, using a nonexistent variable to achieve the result:
    {IF_VAR unit.advances_to equals $tmp_steppe_emptyvariable (
    [then]

#    [chat]
#        message="citizen amla event triggered"
#    [/chat]

    [object]
        silent=yes
        duration=forever
        [filter]
            find_in=unit
        [/filter]
        [effect]
            apply_to=new_advancement
{STEPPE_ADVANCEMENT khaganatecitizen _"Khaganate Citizenship: the unit is no longer a slave, and becomes a khaganate unit, +15% damage, and loyal trait, +20% XP" faction-icons/khaganate.png (
        strict_amla=yes
        max_times=1
        [filter]
            ability=steppe_slave #this is so the AMLA can't be selected if the unit is freed under rare specific conditions
        [/filter]
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_STEPPE_SLAVE}
                {ABILITY_WASLEADER}
            [/abilities]
        [/effect]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_KHAGANATEFACTION}
			[/abilities]
		[/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=attack
            increase_damage=15%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
    [/effect]
    [/object]

    [/then])}
[/event]
[event]
    name=post advance
    id=steppe_slave_citizenship2
    first_time_only=no
    [filter]
      ability=steppe_loyaltrait
    [/filter]

#    [chat]
#        message="citizen amla post advance triggered"
#    [/chat]

    [object]
        silent=yes
        duration=forever
        [filter]
            find_in=unit
        [/filter]
		[effect]
			apply_to=remove_ability
			[abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
			[/abilities]
		[/effect]
    [/object]

    [modify_unit]
        [filter]
            id=$unit.id
        [/filter]
        {TRAIT_LOYAL}
    [/modify_unit]

    [unit_overlay]
        id=$unit.id
        image=misc/loyal-icon.png
    [/unit_overlay]

    [remove_unit_overlay]
        id=$unit.id
        image="misc/hero-icon-old.png~CS(-101,-101,-101)"
    [/remove_unit_overlay]
[/event]

[event]
    name=post advance
    id=steppe_amla_canrecruit
    first_time_only=no
    [filter]
      ability=steppe_amla_canrecruit
    [/filter]

    {MODIFY_UNIT id=$unit.id canrecruit yes}

[/event]
[event]
    name=pre advance
    id=steppe_amla_canrecruit2
    first_time_only=no
    [filter]
      type=Khaganate_Serpenthead_Khagan
    [/filter]

#    [chat]
#      message="khagan canrecruit event triggered"
#    [/chat]

    {IF_VAR unit.canrecruit equals yes (
    [then]

#remove the canrecruit advancement if the unit can already recruit
    [object]
        silent=yes
        duration=turn #duration is only one turn, just in case the unit loses his leadership somehow, like through another add-on
        [filter]
            find_in=unit
        [/filter]
        [effect]
            apply_to=remove_advancement
            amlas=canrecruit
        [/effect]
    [/object]

    [/then]
    )}
[/event]
#turns out this code was unnecessary, a simple filter fix was enough
#[event]
#    name=pre advance
#    id=steppe_sentinel_leadership
#    first_time_only=no
#    [filter]
#      type=Khaganate_Sentinel,Khaganate_Marksman
#    [/filter]
#
#    {IF_VAR unit.variation equals freed (
#    [then]
#
#    [object]
#        silent=yes
#        duration=turn #duration is only one turn, just in case the unit's variation changes
#        [filter]
#            find_in=unit
#        [/filter]
#        [effect]
#            apply_to=remove_advancement
#            amlas=oversight
#        [/effect]
#    [/object]
#
#    [/then]
#    [else]
#
#    [object]
#        silent=yes
#        duration=turn #duration is only one turn, just in case the unit's variation changes
#        [filter]
#            find_in=unit
#        [/filter]
#        [effect]
#            apply_to=remove_advancement
#            amlas=lesser_leadership
#        [/effect]
#    [/object]
#
#    [/else]
#    )}
#[/event]
#enddef

#define STEPPE_AMLA_HP
{STEPPE_ADVANCEMENT steppe_hp _"+5 Max Hp, +20% XP" icons/amla-default.png (
        strict_amla=yes
        max_times=100
        [effect]
            apply_to=hitpoints
            increase_total=5
        [/effect]        
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#-------------------------------------------------------------------------------
#Bull Tumen AMLAs:

#define STEPPE_AMLA_CHARIOT
{STEPPE_AMLA_HP}
{STEPPE_ADVANCEMENT melee_damage _"+15% melee damage, +20% XP" attacks/axe-crude.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=15%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT linebreaker _"Linebreaker: trample gains stun special, +20% XP" attacks/kick-horse.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=trample
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_STUN}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT spear_damage _"+2 spear damage, +20% XP" attacks/javelin-orcish.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=spear
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_BULL
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+15% melee damage, +20% XP" attacks/horn.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=15%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT regeneration _"lesser regenerates +6 is replaced by normal regenerates, +15% XP" icons/heal-royal-1.png (
        strict_amla=yes
        max_times=1
		[effect]
			apply_to=remove_ability
			[abilities]
				{ABILITY_STEPPE_REGENERATES_LESSER 6}
			[/abilities]
		[/effect]
		[effect]
			apply_to=new_ability
			[abilities]
                {ABILITY_REGENERATES}
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

{STEPPE_ADVANCEMENT movement _"+1 moves, +20% XP" attacks/kick-horse.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=movement
            increase=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

{STEPPE_ADVANCEMENT drain _"Ritual Bull: 8-1 cold ranged magical drain attack, +20% XP" attacks/blood-magic-1.png (
        strict_amla=yes
        max_times=1
		[effect]
			apply_to=new_attack
#note: [attack] tags are not needed when adding attacks via effect
        name=drain
        description=_"drain life"
        icon=attacks/blood-magic-1.png
        type=cold
        range=ranged
        damage=8
        number=1
        [specials]
            {WEAPON_SPECIAL_MAGICAL}
            {WEAPON_SPECIAL_DRAIN}
        [/specials]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT drain_damage _"+4 drain life damage, +15% XP" attacks/blood-magic-1.png (
        strict_amla=yes
        require_amla="drain"
        max_times=1
        [effect]
            apply_to=attack
            name=drain
            increase_damage=4
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}
#enddef

#-------------------------------------------------------------------------------
#Serpent Khaganate AMLAs:

#define STEPPE_AMLA_KHAGAN
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT enslave_lvl4 _"Submission: enslave 3 is replaced by enslave 4, +20% XP" attacks/evil-eye-gold-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=willbreak
            remove_specials=steppe_enslave
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_ENSLAVE 4}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT double_enslave _"Can use the enslave attack twice per turn, +25% XP" attacks/evil-eye-gold-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=willbreak
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_DOUBLE_ATTACK}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=25%
        [/effect]
)}

{STEPPE_ADVANCEMENT fire_damage _"+15% black fire damage, black fire ignores 15% of enemy fire resistance, +20% XP" attacks/black-flame.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=blackfire
            increase_damage=15%
#            remove_specials=penetrate_armor_20
            [set_specials]
                mode=append
                {STEPPE_PENETRATE_ARMOR 15}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_PENETRATE_ARMOR 15}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT enslave_damage _"+30% enslavement damage, +15% XP" attacks/evil-eye-gold-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=willbreak
            increase_damage=30%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

#commented out, as extra accuracy is no longer relevant now that serpentheads have always hits on their enslave attacks

#{STEPPE_ADVANCEMENT willbreak_accuracy1 _"enslave attack gains 90% chance to hit, +15% XP" #attacks/evil-eye-gold-2.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=attack
#            name=willbreak
#            remove_specials=steppe_focused
#            [set_specials]
#                mode=append
#                {WEAPON_SPECIAL_STEPPE_HYPERFOCUSED}
#            [/set_specials]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=15%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT willbreak_accuracy2 _"enslave attack gains 100% chance to hit, +15% XP" #attacks/evil-eye-gold-3.png (
#        strict_amla=yes
#        max_times=1
#        require_amla="willbreak_accuracy1"
#        [effect]
#            apply_to=attack
#            name=willbreak
#            remove_specials=steppe_hyperfocused
#            [set_specials]
#                mode=append
#                {WEAPON_SPECIAL_STEPPE_ALWAYS_HITS}
#            [/set_specials]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=15%
#        [/effect]
#)}

{STEPPE_ADVANCEMENT_FILTERED canrecruit _"Khagan's Authority: allows the unit to recruit, +15% XP" misc/leader-crown.png (
        canrecruit=no
) (
        strict_amla=yes
        max_times=1
		[effect]
			apply_to=new_ability
			[abilities]
              [dummy]
                 id=steppe_amla_canrecruit #dummy ability to trigger post advance
              [/dummy]
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_NUCKELAVEE_BLACKSPEAR
{STEPPE_AMLA_HP}
{STEPPE_ADVANCEMENT melee_damage _"+2 melee damage, +20% XP" attacks/spear-nuckelavee-black.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT movement _"+1 moves, +15% XP" attacks/kick-horse.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=movement
            increase=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_NUCKELAVEE_BANSHEETAUR
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT claw_drain _"claws gain the drain special, +20% XP" attacks/claws-undead.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=claws
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_DRAIN}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT wail_damage _"+2 wail damage, +20% XP" attacks/wail.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=wail
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_PUNISHER
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+20% melee damage, +20% XP" attacks/scimitar.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT enslave_lvl2 _"enslave 1 is replaced by enslave 2, +20% XP" attacks/whip.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=whip
            remove_specials=steppe_enslave
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_ENSLAVE_LIVING 2}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT oversight _"oversight 33% is replaced by oversight 45%, +20% XP" attacks/evil-eye-gold-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_OVERSIGHT 33}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_OVERSIGHT 45}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef


#define STEPPE_AMLA_KHAGANATE_SENTINEL
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+20% melee damage, +20% XP" attacks/pike.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT oversight _"oversight 15% ability and loyal trait, +20% XP" attacks/evil-eye-gold-1.png (
        strict_amla=yes
        max_times=1
        [filter]
            [not]
                [filter_wml]
                    variation=freed
                [/filter_wml]
            [/not]
        [/filter]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_OVERSIGHT 15}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT lesser_leadership _"lesser leadership ability and loyal trait, +20% XP (available only when freed)" icons/haste-fire-2.png (
        strict_amla=yes
        max_times=1
        [filter]
            [filter_wml]
                variation=freed
            [/filter_wml]
        [/filter]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_LESSER_LEADERSHIP}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_KHAGANATE_MARKSMAN
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT ranged_damage _"+20% ranged damage, +20% XP" attacks/bow-elven.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=ranged
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT oversight _"oversight 15% ability and loyal trait, +20% XP (available only when freed)" attacks/evil-eye-gold-1.png (
        strict_amla=yes
        max_times=1
        [filter]
            [not]
                [filter_wml]
                    variation=freed
                [/filter_wml]
            [/not]
        [/filter]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_OVERSIGHT 15}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT lesser_leadership _"lesser leadership ability and loyal trait, +20% XP" icons/haste-fire-2.png (
        strict_amla=yes
        max_times=1
        [filter]
            [filter_wml]
                variation=freed
            [/filter_wml]
        [/filter]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_LESSER_LEADERSHIP}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_KHAGANATE_ROUSER
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT damage _"+2 spear damage, +1 bow damage, +20% XP" attacks/spear.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=spear
            increase_damage=2
        [/effect]
        [effect]
            apply_to=attack
            name=bow
            increase_damage=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT oversight _"oversight 15% ability, +20% XP" attacks/evil-eye-gold-1.png (
        strict_amla=yes
        max_times=1
        [filter]
            [not]
                [filter_wml]
                    variation=freed
                [/filter_wml]
            [/not]
        [/filter]
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_OVERSIGHT 15}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_OVERSIGHT 15}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT inspire _"Replace leadership with inspire, +20% XP (available only when freed)" icons/haste-fire-2.png (
        strict_amla=yes
        max_times=1
        [filter]
            [filter_wml]
                variation=freed
            [/filter_wml]
        [/filter]
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_LEADERSHIP}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_INSPIRE}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT movement _"+1 moves, +20% XP" icons/boots_elven.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=movement
            increase=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#-------------------------------------------------------------------------------
#Dead Field Coven AMLAs:


#define STEPPE_AMLA_RODIMITSA
{STEPPE_AMLA_HP}
{STEPPE_ADVANCEMENT onewithnature _"One with Nature: +10% forest defense and ambush ability, +20% XP" icons/leaf-acid-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=defense
            replace=no
            [defense]
                forest=-10
            [/defense]
        [/effect]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT herbalmaster _"Herbal Mastery: heal +8 is replaced by heal +10, +20% XP" icons/heal-jade-2.png (
        strict_amla=yes
        max_times=1
		[effect]
			apply_to=remove_ability
			[abilities]
				{ABILITY_GSE_CURES}
			[/abilities]
		[/effect]
		[effect]
			apply_to=new_ability
			[abilities]
                {ABILITY_STEPPE_CURES 10}
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT naturescruelty _"Nature's Cruelty: nature's curse attack gains poison special, +20% XP" attacks/curse-witch-nature.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=curse
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_POISON}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_WILD_WITCH
{STEPPE_AMLA_HP}
{STEPPE_ADVANCEMENT swampstalk _"One with the Swamp: +10% swamp defense and swampstalk ability, +20% XP" icons/swampstalk.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=defense
            replace=no
            [defense]
                swamp_water=-10
            [/defense]
        [/effect]
		[effect]
			apply_to=new_ability
			[abilities]
                {ABILITY_STEPPE_SWAMPSTALK}
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT fire_damage _"+2 swamp fire damage, +20% XP" attacks/swamp-fire.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=swamp fire
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT evileye _"Hateful Gaze: +4 evil eye damage, and evil eye gains the stun special, +20% XP" attacks/gaze.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=evil eye
            increase_damage=4
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_STUN}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_FEAR_INCARNATE

#amla ideas: nightstalk, pack leader (leadership that only works on wolves), drain on melee

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT nightstalk _"Nightstalk ability, +20% XP" attacks/horror-eerie-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_NIGHTSTALK}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT pack_alpha _"Pack alpha and skimirsher abilities, +25% XP" icons/wild-eerie-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
            [leadership]
                id=steppe_pack_alpha
                value="(25 * (level - other.level))"
                cumulative=no
                name=_"pack alpha" "вожак стаи"
                description=_"Works like normal leadership, but only works on wolves."
                affect_self=no
                [affect_adjacent]
                    [filter]
                        formula="level < other.level"
                        [and]
                            race=wolf
                            [or]
                                ability=steppe_wolf
                            [/or]
                        [/and]
                    [/filter]
                [/affect_adjacent]
            [/leadership]
                {ABILITY_SKIRMISHER}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

{STEPPE_ADVANCEMENT melee_damage _"+1 melee damage, +20% XP" attacks/fangs-ghost.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_SHADOWSHOT
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT shadow_poison _"Shadow Poison: bow and arrow dance attacks gain poison special, +20% XP" icons/slice-acid-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=bow,arrowdance
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_POISON}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_MISTRESS_OF_DEAD_FIELD
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT arcane_shield _"Arcane Shield: +10% to all resistances, +20% XP" icons/protect-magenta-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=resistance
            replace=no
            [resistance]
                arcane=-10
                fire=-10
                cold=-10
                blade=-10
                pierce=-10
                impact=-10
            [/resistance]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT lesser_leadership _"Lesser Leadership ability, +20% XP" icons/haste-royal-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_LESSER_LEADERSHIP}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT teleport _"Teleport ability, +20% XP" icons/wind-grasp-eerie-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_TELEPORT}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_SLASHER
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT controlled_rage _"Controlled Rage: berserk now works only on offense, +20% XP" attacks/frenzy.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
#            range=melee
            special_id=berserk
            remove_specials=berserk
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_OFFENSE_BERSERK}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT swift_blade _"Swift Blade: melee gains the reliable special, +20% XP" icons/slice-spirit-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_RELIABLE}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_FIEND

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT bloodlust _"Bloodlust: drain 33% special on melee, and feeding ability, +20% XP" attacks/blood-magic-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_CUSTOM_DRAIN 33}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_FEEDING}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT melee_damage _"+2 melee damage, +20% XP" attacks/claws-undead.png (
        strict_amla=yes
        max_times=3
        [effect]
            apply_to=attack
            range=melee
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT plague _"Plague spawns lvl1 ghouls instead of lvl0 ones, +20% XP" "units/hunns/ghoul1.png~RC(magenta>black)" (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            remove_specials="plague(Hunn_Lesser_Ghoul)"
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_PLAGUE_TYPE Hunn_Ghoul}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_IMP
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT clot_damage _"+2 dark clot damage, +20% XP" attacks/dark-missile.png (
        strict_amla=yes
        max_times=3
        [effect]
            apply_to=attack
            name=dark clot
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT transform_slow _"Curse of transformation now slows enemies, +20% XP" attacks/evil-eye-eerie-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=curse of transformation
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_SLOW}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT double_transform _"Can use the curse of transformation attack twice per turn, +25% XP" attacks/evil-eye-eerie-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=curse of transformation
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_DOUBLE_ATTACK}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=25%
        [/effect]
)}
#enddef

#-------------------------------------------------------------------------------
#Northern Knyaz Triumvirate AMLAs:

#define STEPPE_AMLA_TEMSK_BRAVEHEART
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT desperate _"Desperate: desperate special on melee, +20% XP" attacks/frenzy.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_DESPERATE}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT bloodlust _"Bloodlust: drain 30% special on melee, +20% XP" attacks/blood-magic-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_CUSTOM_DRAIN 30}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT resolute _"Resolute ability, +20% XP" icons/protect-red-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_RESOLUTE}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_TEMSK_CHAMPION
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT blade_mastery _"Blade Mastery: +1 damage and reliable special on sword in human form, +20% XP" attacks/sword-human.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=sword
            increase_damage=1
        [/effect]
        [effect]
            apply_to=attack
            name=sword
#            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_RELIABLE}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT raven_damage _"Bird of Prey: +2 claw damage/+8 beak damage in raven form, and +4 raven damage in human form, +20% XP" attacks/beak.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=claws
            increase_damage=2
        [/effect]
        [effect]
            apply_to=attack
            name=beak
            increase_damage=8
        [/effect]
        [effect]
            apply_to=attack
            name=raven
            increase_damage=4
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT raven_tactics _"Hunting Tactics: poison for claws, and hit-and-run for beak in raven form (as well as raven attack in human form), +20% XP" attacks/claws-animal.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=claws
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_POISON}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=attack
            name=beak
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_HITANDRUN 3}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=attack
            name=raven
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_HITANDRUN 2}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT nightstalk _"Nightstalk ability for both forms, +20% XP" attacks/horror-eerie-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_NIGHTSTALK}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}


{STEPPE_ADVANCEMENT lesser_leadership _"Lesser Leadership ability for both forms, +20% XP" icons/haste-royal-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_LESSER_LEADERSHIP}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT footwork _"Footwork: skirmisher ability for human form, +15% XP" icons/boots_elven.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_SKIRMISHER}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

#enddef

##define STEPPE_AMLA_KRAD_ARCHITECT
#{STEPPE_AMLA_HP}
#
#{STEPPE_ADVANCEMENT tool_damage _"+2 damage for magical tools, +20% XP" attacks/axe.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=attack
#            name=magical tools
#            increase_damage=2
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT stronger_buildings _"Stronger Buildings: this unit's buildings deal 25% more damage (doesn't apply to ones already built), +20% XP" attacks/#ballista.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=new_ability
#            [abilities]
#                {ABILITY_STEPPE_BUILDING_BONUS_DAMAGE 25}
#            [/abilities]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT sturdier_buildings _"Studier Buildings: this unit's buildings have 30% more hitpoints (doesn't apply to ones already built), +20% XP" icons/#stone_ring.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=new_ability
#            [abilities]
#                {ABILITY_STEPPE_BUILDING_BONUS_HITPOINTS 30}
#            [/abilities]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
##enddef
#
##define STEPPE_AMLA_ZIMNOVSK_ARCHITECT
#{STEPPE_AMLA_HP}
#
#{STEPPE_ADVANCEMENT_BUILDOPTION building_teleporter _"Teleporter: can build teleporters, +20% XP" icons/runes-blue-3.png teleporter ( _ "Build Teleporter") ( _ "#Построить Телепортер") 18 (Slav_Teleporter) 66 (
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT_BUILDOPTION building_library _"Library: can build libraries (buildings that give experience to adjacent allies each turn), +20% XP" icons/#book.png library ( _ "Build Library") ( _ "Построить Библоитеку") 14 (Slav_Library) 66 (
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT_BUILDOPTION building_makeshift_wall _"Makeshift Walls: can build wood walls for 0 gold but 75% move cost (dees not replace the 4 gold option, #functionally both spiketraps are identical), +20% XP" "terrain/castle/encampment/regular-tile.png" makeshift_woodwall ( _ "Build makeshift wall") ( _ "Построить #импровизированную стену") 0 (Woodwall) 75 (
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT tool_damage _"+2 damage for magical tools, +20% XP" attacks/hammer.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=attack
#            name=magical tools
#            increase_damage=2
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT sturdier_buildings _"Studier Buildings: this unit's buildings have 30% more hitpoints (doesn't apply to ones already built), +20% XP" icons/#stone_ring.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=new_ability
#            [abilities]
#                {ABILITY_STEPPE_BUILDING_BONUS_HITPOINTS 30}
#            [/abilities]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
##enddef
#
##define STEPPE_AMLA_TEMSK_ARCHITECT
#{STEPPE_AMLA_HP}
#
#{STEPPE_ADVANCEMENT_BUILDOPTION building_hiding_spot _"Hiding spot: can build hiding spots, +20% XP" icons/hiding-spot.png hiding_spot ( _ "Build Hiding Spot") 10 (#Slav_Hiding_Spot) 66 (
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT_BUILDOPTION building_makeshift_spikes _"Makeshift Spikes: can build spikes for 0 gold but 80% move cost (dees not replace the 3 gold option, #functionally both spiketraps are identical), +20% XP" attacks/spikes.png makeshift_spiketrap ( _ "Build makeshift spikes") 0 (Spiketrap) 80 (
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT tool_damage_and_poison _"+1 damage and poison for magical tools, +20% XP" attacks/spikes-poison.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=attack
#            name=magical tools
#            increase_damage=1
#            set_icon=attacks/spikes-poison.png
#            [set_specials]
#                mode=append
#                {WEAPON_SPECIAL_POISON}
#            [/set_specials]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT deadlier_traps _"Deadlier Traps: this unit's traps deal 30% more damage (doesn't apply to traps already built), +20% XP" attacks/#spear-nuckelavee.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=new_ability
#            [abilities]
#                {ABILITY_STEPPE_BUILDING_BONUS_DAMAGE 30}
#            [/abilities]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
##enddef

#define STEPPE_AMLA_LUMINARY
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT herbalmaster _"Healing Light: heal +8 is replaced by heal +10, +20% XP" icons/heal-royal-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=remove_ability
            [abilities]
#                {ABILITY_STEPPE_CURES 6}
                {ABILITY_CURES}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_CURES 10}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT ranged_damage _"+3 light burst damage, +2 solar flame damage, +20% XP" attacks/light-burst.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=light burst
            increase_damage=3
        [/effect]
        [effect]
            apply_to=attack
            name=solar flame
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT light_shield _"Light Shield: +20% fire/arcane resistances, +20% XP" icons/protect-royal-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=resistance
            replace=no
            [resistance]
                arcane=-20
                fire=-20
            [/resistance]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_BUILDER
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT ranged_damage _"+3 enchanted light damage, +1 magical tool strike +20% XP" attacks/magic-missile.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=enchanted light
            increase_damage=3
        [/effect]
        [effect]
            apply_to=attack
            name=magical tools
            increase_attacks=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT repair _"Repair Mastery: repair +9 is replaced by repair +12, +20% XP" icons/stone_ring.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_STEPPE_REPAIR 9}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_REPAIR 12}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT_BUILDOPTION building_market _"Marketplace: can build marketplaces, +20% XP" icons/market.png marketplace ( _ "Build Marketplace") $steppe_marketplace_cost (Slav_Marketplace) 5 (
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT_BUILDOPTION building_teleporter _"Teleporter: can build teleporters, +20% XP" icons/runes-blue-3.png teleporter ( _ "Build Teleporter") 18 (Slav_Teleporter) 4 (
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#{STEPPE_ADVANCEMENT_BUILDOPTION building_library _"Library: can build libraries (buildings that give experience to adjacent allies each turn), +20% XP" icons/book.png library ( _ "Build Library") 14 (Slav_Library) 4 (
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}

#commented out, since now the "hiding allies" ability was moved to Bard AMLA

#{STEPPE_ADVANCEMENT_BUILDOPTION building_hiding_spot _"Hiding spot: can build hiding spots, +20% XP" icons/hiding-spot.png hiding_spot ( _ "Build Hiding Spot") 10 (Slav_Hiding_Spot) 4 (
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#enddef

#define STEPPE_AMLA_GRAND_GUARD
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT resolute _"Resolute ability, +20% XP" icons/protect-red-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_RESOLUTE}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT shield _"Shield attack (12-1 block 50%), +20% XP" attacks/rectangular-shield.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_attack
            name="shield"
            description= _ "shield"
            icon=attacks/rectangular-shield.png
            type=impact
            range=melee
            [specials]
                {WEAPON_SPECIAL_BLOCK 50 0.5}
            [/specials]
            damage=12
            number=1
        [/effect]
        [effect]
            apply_to=new_animation
            [attack_anim]
                [filter_attack]
                    name=shield
                [/filter_attack]
        
                start_time=-200
        
                [frame]
                duration=300
                [/frame]
        
                {SOUND:HIT_AND_MISS mace.wav {SOUND_LIST:MISS} -50}
            [/attack_anim]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#{STEPPE_ADVANCEMENT stronger_buildings _"Stronger Buildings: this unit's buildings deal 25% more damage (doesn't apply to ones already built), +20% XP" attacks/#ballista.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=new_ability
#            [abilities]
#                {ABILITY_STEPPE_BUILDING_BONUS_DAMAGE 25}
#            [/abilities]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}

{STEPPE_ADVANCEMENT sturdier_buildings _"Studier Buildings: this unit's buildings have 30% more hitpoints (doesn't apply to ones already built), +20% XP" icons/stone_ring.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDING_BONUS_HITPOINTS 30}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_SENTINEL
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+3 pike damage, +20% XP" attacks/pike.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=spear
            increase_damage=3
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT ranged_damage _"+5 javelin damage, +20% XP" attacks/javelin-human.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=javelin
            increase_damage=5
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}


{STEPPE_ADVANCEMENT resolute _"Resolute ability, +20% XP" icons/protect-red-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_RESOLUTE}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT sturdier_buildings _"Studier Buildings: this unit's buildings have 30% more hitpoints (doesn't apply to ones already built), +20% XP" icons/stone_ring.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDING_BONUS_HITPOINTS 30}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_SHARPSHOOTER
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT stronger_buildings _"Stronger Buildings: this unit's buildings deal 30% more damage (doesn't apply to ones already built), +20% XP" attacks/ballista.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDING_BONUS_DAMAGE 30}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT sturdier_buildings _"Studier Buildings: this unit's buildings have 30% more hitpoints (doesn't apply to ones already built), +20% XP" icons/stone_ring.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDING_BONUS_HITPOINTS 30}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_SLAV_RANGER
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+2 melee damage, +20% XP" attacks/axe.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT ranged_damage _"+2 ranged damage, +20% XP" attacks/bow.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=ranged
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT forest_swamp_defenses _"+10% forest/swamp defense, reduced movement cost on swamps, +20% XP" icons/leaf-acid-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=defense
            replace=no
            [defense]
                forest=-10
                swamp_water=-10
            [/defense]
        [/effect]
        [effect]
            apply_to=movement_costs
            replace=yes
            [movement_costs]
                swamp_water=1
            [/movement_costs]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_AMBUSH}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT nightstalk _"Nightstalk ability, +20% XP" attacks/horror-eerie-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_NIGHTSTALK}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT cunning _"Cunning: skirmisher and concealment abilities, +20% XP" icons/cloak_leather_brown.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_SKIRMISHER}
                {ABILITY_CONCEALMENT}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT deadlier_traps _"Deadlier Traps: this unit's traps deal 50% more damage (doesn't apply to traps already built), +20% XP" attacks/spikes.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDING_BONUS_DAMAGE 50}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_USHKUYNIK
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+20% melee damage, +20% XP" attacks/axe.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT waterproof_armor _"Waterproof Enchanted Armor: +10% water defense, better movement on shallow water, +20% XP" attacks/waterspray.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=defense
            replace=no
            [defense]
                shallow_water=-10
                reef=-10
                swamp_water=-10
            [/defense]
        [/effect]
        [effect]
            apply_to=movement_costs
            replace=yes
            [movement_costs]
                shallow_water=2
            [/movement_costs]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT diving_gear _"Enchanted Diving Gear: +10% water defense, can move on deep water, submerge ability, +20% XP" icons/helmet_frogmouth.png (
        strict_amla=yes
        max_times=1
        require_amla=waterproof_armor
        [effect]
            apply_to=defense
            replace=no
            [defense]
                deep_water=-30
                shallow_water=-10
                reef=-10
                swamp_water=-10
            [/defense]
        [/effect]
        [effect]
            apply_to=movement_costs
            replace=yes
            [movement_costs]
                deep_water=3
            [/movement_costs]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_SUBMERGE}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_BARD
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT battle_bard _"Battle Bard: +1 sound wave damage, +2 dagger damage, and weaken 15% instead of weaken 10%, +20% XP" icons/crossed_sword_and_hammer.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=dagger
            increase_damage=2
        [/effect]
        [effect]
            apply_to=attack
            name=sound wave
            increase_damage=1
            remove_specials=steppe_weaken
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_WEAKEN 15}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT music_mastery _"Music Mastery: default bard songs are replaced with stronger versions, +20% XP" icons/instrument_kantele.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=remove_ability
            [abilities]
                [dummy]
                    id=steppe_bardsongs_lvl2
                [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                [dummy]
                    id=steppe_bardsongs_lvl3
                [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT song_invis _"Song: <i>Into The Shadows</i>: makes adjacent allies invisible, +20% XP" icons/instrument_kantele.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                [dummy]
                    id=steppe_bardsongs_invis
                [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT song_wisdom _"Song: <i>Revelation</i>: adjacent allies gain 2 EXP each turn, +20% XP" icons/instrument_kantele.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                [dummy]
                    id=steppe_bardsongs_wisdom
                [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#-------------------------------------------------------------------------------
#Ogre Kingdom AMLAs:

#define STEPPE_AMLA_BATTLE_SERF

#TODO: move most of the fancier AMLAS onto vassals later, and maybe remove the paths

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+1/2 melee damage, +20% XP" attacks/halberd.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=halberd
            increase_damage=1
        [/effect]
        [effect]
            apply_to=attack
            name=halberd_slash
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT melee_damage2 _"+2/2 melee damage, +20% XP" attacks/halberd.png (
        strict_amla=yes
        max_times=1
        require_amla=melee_damage
        [effect]
            apply_to=attack
            name=halberd
            increase_damage=2
        [/effect]
        [effect]
            apply_to=attack
            name=halberd_slash
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT defense _"Defense: +10% physical resistances and firststrike, cannot take other paths after this, +20% XP" attacks/rectangular-shield.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=resistance
            replace=no
            [resistance]
                blade=-10
                pierce=-10
                impact=-10
            [/resistance]
        [/effect]
        [effect]
            apply_to=attack
            name=halberd,halberd_slash
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_FIRSTSTRIKE}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef


#define STEPPE_AMLA_MESSENGER

#TODO: move most of the fancier AMLAS onto vassals later, and maybe remove the paths

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT axe_damage _"+3 melee damage axe, +20% XP" attacks/axe.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=3
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT sling_damage _"+2 sling damage, +20% XP" attacks/sling.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=sling
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT cunning _"Cunning: skirmisher and concealment abilities, +20% XP" icons/cloak_leather_brown.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_SKIRMISHER}
                {ABILITY_CONCEALMENT}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT movement _"+1 moves, +20% XP" icons/boots_elven.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=movement
            increase=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_VASSAL_ELDEST_SON
{STEPPE_ADVANCEMENT feast_hp _"Feast in his honor! (+8 Max Hp), +20% XP" icons/amla-default.png (
        strict_amla=yes
        max_times=100
        [effect]
            apply_to=hitpoints
            increase_total=8
        [/effect]        
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT hunt_damage _"Hunt in his honor! (+10% damage), +15% XP" attacks/sword-human.png (
        strict_amla=yes
        max_times=100
        [effect]
            apply_to=attack
            increase_damage=10%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

{STEPPE_ADVANCEMENT canrecruit _"Ascend him to the throne!, -10% XP" misc/leader-crown.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_amla_canrecruit #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=type
            name=Kingdom_Pan
        [/effect]
        [effect]
            apply_to=max_experience
            increase=-10%
        [/effect]
)}
#enddef

#TODO: add proper AMLAs for vassals:

#define STEPPE_AMLA_VASSAL_BISHOP

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT ranged_damage _"+20% ranged damage, +20% XP" attacks/lightbeam.png (
        strict_amla=yes
        max_times=5
        [effect]
            apply_to=attack
            range=ranged
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT faith_healing _"Faith Healing ability, +20% XP" icons/heal-royal-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_FAITH_HEALING}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT illuminate _"Illuminates ability, +20% XP" attacks/lightbeam.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_ILLUMINATES}
            [/abilities]
        [/effect]
        [effect]
            apply_to=halo
            halo="halo/illuminates-aura.png"
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_VASSAL_MERCENARY

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT ranged_damage _"+20% ranged damage, +20% XP" attacks/crossbow-human.png (
        strict_amla=yes
        max_times=5
        [effect]
            apply_to=attack
            range=ranged
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT armor_penetration _"Better at penetrating armor, +20% XP" icons/armorbreak-magical.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=ranged
            remove_specials=penetrate_armor_20
            [set_specials]
                mode=append
                {STEPPE_PENETRATE_ARMOR 30}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_PENETRATE_ARMOR 30}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_VASSAL_KNIGHT

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT damage _"+20% damage, +20% XP" attacks/lance.png (
        strict_amla=yes
        max_times=5
        [effect]
            apply_to=attack
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT giantslayer _"Giantslayer ability (deals more damage to enemies of higher level), +20% XP" attacks/fist-troll.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_GIANTSLAYER}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT giantslayer2 _"Percentile damage bonus on attacks, +20% XP" attacks/scarab-horn.png (
        strict_amla=yes
        max_times=1
        require_amla=giantslayer
        [effect]
            apply_to=attack
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_PERCENTILE_DAMAGE 5 0.05}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_VASSAL_BANDIT

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT ranged_damage _"+20% ranged damage, +20% XP" attacks/crossbow-undead.png (
        strict_amla=yes
        max_times=5
        [effect]
            apply_to=attack
            range=ranged
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT nightstalk _"Nightstalk ability, +20% XP" attacks/horror-eerie-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_NIGHTSTALK}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT cunning _"Cunning: skirmisher and concealment abilities, +20% XP" icons/cloak_leather_brown.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_SKIRMISHER}
                {ABILITY_CONCEALMENT}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT incinerate_and_poison _"Incinerate special on the fire crossbow, and poison on normal crossbow, +20% XP" attacks/fireball.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=crossbow
            type=pierce
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_POISON}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=attack
            name=crossbow
            type=fire
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_INCINERATE}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_VASSAL_TROLL

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT damage _"+20% damage, +20% XP" attacks/mace.png (
        strict_amla=yes
        max_times=5
        [effect]
            apply_to=attack
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT mentor _"Better at mentoring (3 xp per turn), +20% XP" icons/mentor.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_STEPPE_MENTOR 2}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_MENTOR 3}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT mentor2 _"Even better at mentoring (4 xp per turn), +20% XP" icons/mentor.png (
        strict_amla=yes
        max_times=1
        require_amla=mentor
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_STEPPE_MENTOR 3}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_MENTOR 4}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

##define STEPPE_AMLA_VASSAL_APOSTATE
#
#{STEPPE_AMLA_HP}
#
#{STEPPE_ADVANCEMENT ranged_damage _"+10% ranged damage, +20% XP" attacks/darkbeam.png (
#        strict_amla=yes
#        max_times=20
#        [effect]
#            apply_to=attack
#            range=ranged
#            increase_damage=10%
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT armorbreak _"Better at reducing enemy resistances (15% armor break instead of 10%), +20% XP" icons/armorbreak-magical.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=attack
#            name=darkbeam
#            remove_specials=steppe_armorbreak
#            [set_specials]
#                mode=append
#                {STEPPE_ARMORBREAK 15}
#            [/set_specials]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT armorbreak2 _"Even better at reducing enemy resistances (20% armor break instead of 15%), +20% XP" icons/armorbreak-magical.png (
#        strict_amla=yes
#        max_times=1
#        require_amla=armorbreak
#        [effect]
#            apply_to=attack
#            name=darkbeam
#            remove_specials=steppe_armorbreak
#            [set_specials]
#                mode=append
#                {STEPPE_ARMORBREAK 20}
#            [/set_specials]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT darken _"Darkens ability, +20% XP" attacks/darkbeam.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=new_ability
#            [abilities]
#                {ABILITY_STEPPE_DARKENS}
#            [/abilities]
#        [/effect]
#        [effect]
#            apply_to=halo
#            halo="halo/darkens-aura.png"
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}
##enddef

#define STEPPE_AMLA_MAGNATE

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT damage _"+20% damage, +20% XP" attacks/mace-spiked.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT wealthier _"Generates 6 gold per turn instead of 4, +20% XP" icons/coins_copper.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_WEALTHY 4}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_WEALTHY 6}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#-------------------------------------------------------------------------------
#Tartarus Mandate AMLAs:

#define STEPPE_AMLA_BLESSING_OF_ABYSS_8
{STEPPE_ADVANCEMENT abyss_blessing _"Blessing of the Abyss: gain nocturnal regeneration +8 ability, +20% XP" icons/heal-nocturnal-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_NOCTURNAL_REGENERATION 8}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_BLESSING_OF_ABYSS_10
{STEPPE_ADVANCEMENT abyss_blessing _"Blessing of the Abyss: gain nocturnal regeneration +10 ability, +20% XP" icons/heal-nocturnal-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_NOCTURNAL_REGENERATION 10}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_BLESSING_OF_ABYSS_12
{STEPPE_ADVANCEMENT abyss_blessing _"Blessing of the Abyss: gain nocturnal regeneration +12 ability, +20% XP" icons/heal-nocturnal-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_NOCTURNAL_REGENERATION 12}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef


#define STEPPE_AMLA_FIRE_LANCER
{STEPPE_AMLA_HP}

{STEPPE_AMLA_BLESSING_OF_ABYSS_8}

{STEPPE_ADVANCEMENT melee_damage _"+25% melee damage, +20% XP" attacks/spear.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=25%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT firework_damage _"+3 firework damage (only ranged), +20% XP" attacks/firework.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=firework
            increase_damage=3
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT enchanted_armor _"Enchanted Armor: +20% to fire/cold resistances, +20% XP" icons/protect-royal-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=resistance
            replace=no
            [resistance]
                fire=-20
                cold=-20
            [/resistance]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT dauntless _"Dauntless ability, +20% XP" icons/haste-fire-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_DAUNTLESS}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_ARROWSTORM
{STEPPE_AMLA_HP}

{STEPPE_AMLA_BLESSING_OF_ABYSS_10}

{STEPPE_ADVANCEMENT focused_fire _"Focused Fire: crossbow gains the 'reliable' special, +20% XP" attacks/crossbow-orcish.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=crossbow
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_RELIABLE}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT rapid_fire _"Rapid Fire: +1 ranged strikes, +20% XP" attacks/crossbow-orcish.png (
        strict_amla=yes
        max_times=2
        [effect]
            apply_to=attack
            name=crossbow
            increase_attacks=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT hillstalk _"Able to hide in hills and mountains, +20% XP" icons/cloak_leather_brown.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_HILLSTALK}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_BOMBARDIER
{STEPPE_AMLA_HP}

{STEPPE_AMLA_BLESSING_OF_ABYSS_10}

#TODO: edit the steppe explosion so that percentage is stored in the special tag itself


{STEPPE_ADVANCEMENT handcannon_damage _"+8 handcannon damage, +20% XP" attacks/thunderstick.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=handcannon
            increase_damage=8
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT bigger_blast _"Bigger Blast: Explosive shot deals 50% damage to adjacent enemies instead of 30%, +20% XP" attacks/explosion-red-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=firework
            remove_specials=steppe_explosion
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_EXPLOSION 50}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}


{STEPPE_ADVANCEMENT bigger_blastII _"Bigger Blast: Explosive shot deals 75% damage to adjacent enemies instead of 50%, +20% XP" attacks/explosion-red-3.png (
        strict_amla=yes
        max_times=1
        require_amla=bigger_blast
        [effect]
            apply_to=attack
            name=firework
            remove_specials=steppe_explosion
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_EXPLOSION 75}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef